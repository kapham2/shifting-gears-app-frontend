(window.webpackJsonp=window.webpackJsonp||[]).push([[0],[,,,,,,,,,function(e,t,a){e.exports=a(20)},,,,,,function(e,t,a){},function(e,t,a){},,function(e,t,a){},function(e,t,a){},function(e,t,a){"use strict";a.r(t);var n=a(0),i=a.n(n),o=a(7),s=a.n(o),c=(a(15),a(1)),r=a(2),l=a(4),d=a(3),h=a(5),u=(a(16),a(17),a(18),a(19),function(e){function t(){var e,a;Object(c.a)(this,t);for(var n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return(a=Object(l.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).onSubmitForm=function(e){var t,n;switch(e.preventDefault(),e.target.querySelector("input")&&(t=e.target.querySelector('input[name="username"]').value.toLowerCase(),n=e.target.querySelector('input[name="password"]').value),a.props.active){case"Sign in":a.authenticate(t,n);break;case"Sign up":a.signUp(t,n);break;case"Sign in as Incognito":a.authenticate("incognito","p@$$w0rd");break;default:console.log("SigninForm: onSubmitForm => ERROR!")}},a.authenticate=function(e,t){console.log("authenticated!"),fetch("https://shifting-gears-app-backend.herokuapp.com/api/v1/signin",{method:"POST",headers:{"Content-type":"application/json"},body:JSON.stringify({user:{username:e,password:t}})}).then(function(e){if(e.ok)return e.json();throw e}).then(function(e){return a.setUserAndRedirect(e)}).catch(function(e){return e.json().then(function(e){return console.log(e)})})},a.setUserAndRedirect=function(e){a.props.updateUserId(e.user.id),localStorage.setItem("token",e.token),a.updateNav()},a.signUp=function(e,t){console.log("signed up!"),e.includes(" ")||/[~`!@#$%^&*()\-+={[}\]|\\:;"'<,>.?\/]/g.test(e)?console.log({error:"Username can't include special characters"}):fetch("https://shifting-gears-app-backend.herokuapp.com/api/v1/users",{method:"POST",headers:{"Content-type":"application/json"},body:JSON.stringify({user:{username:e,password:t}})}).then(function(e){if(e.ok)return e.json();throw e}).then(function(e){return a.setUserAndRedirect(e)}).catch(function(e){return e.json().then(function(e){return console.log(e)})})},a.updateNav=function(){a.props.updateSignedIn(),a.props.updateActive("Game"),document.getElementsByClassName("nav-link active")[0].classList.remove("active"),document.getElementsByClassName("nav-link")[0].classList.add("active")},a}return Object(h.a)(t,e),Object(r.a)(t,[{key:"componentDidMount",value:function(){localStorage.clear(),this.props.updateActive("Sign in"),document.getElementsByClassName("nav-link active")[0].classList.remove("active"),document.getElementsByClassName("nav-link")[0].classList.add("active")}},{key:"render",value:function(){var e="Sign in as Incognito"===this.props.active?"":i.a.createElement("div",null,i.a.createElement("input",{type:"text",id:"inputUsername",className:"form-control",placeholder:"Username",name:"username",required:!0,autoFocus:!0}),i.a.createElement("input",{type:"password",id:"inputPassword",className:"form-control",placeholder:"Password",name:"password",required:!0}));return i.a.createElement("form",{className:"form-signin",onSubmit:this.onSubmitForm},e,i.a.createElement("button",{className:"btn shadow-sm btn-block",type:"submit"},this.props.active))}}]),t}(i.a.Component)),m=a(8),p=function(e){function t(){var e,a;Object(c.a)(this,t);for(var n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return(a=Object(l.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).drawGame=function(e,t){e.clearRect(0,0,e.canvas.width,e.canvas.height),e.translate(0,a.height),a.drawElevation(e),a.drawCyclist(e,t),a.drawTick(e),a.drawVelocityScale(e),e.translate(0,-a.height)},a.drawElevation=function(e){var t=-a.props.elevation[0]*a.elevationScale,n=-a.props.elevation[a.indexLast]*a.elevationScale;e.beginPath(),e.moveTo(0,0),e.lineTo(0,t),a.props.elevation.forEach(function(t,n){var i=n*a.props.distanceToIndexRatio*a.distanceScale+a.imgWidth/2,o=-t*a.elevationScale;return e.lineTo(i,o)}),e.lineTo(a.width,n),e.lineTo(a.width,0),e.fillStyle="#566E7A",e.fill()},a.drawVelocityScale=function(e){e.font="bold 18px Helvetica Neue",e.textAlign="left",e.fillStyle="#FFFFFF",e.fillText("Score: ".concat(0===a.props.time?0:Math.round(a.props.distance/(a.props.time/1e3)*100)/100),a.width/2,-85),e.beginPath(),e.moveTo(0,60),e.lineTo(a.width,60),e.strokeStyle="#192D4BF2",e.lineWidth=3,e.stroke(),e.textAlign="center",e.fillText("Max Velocity in Current Gear",a.width/2,40);for(var t=0;t<a.props.velocityMax.length;t++)e.beginPath(),e.moveTo(25*a.props.velocityMax[t],70),e.lineTo(25*a.props.velocityMax[t],50),e.strokeStyle=t===a.props.idxTeethCog?"#FFFFFF":"#192D4BF2",e.lineWidth=3,e.stroke();e.beginPath(),e.moveTo(25*a.props.velocity,70),e.lineTo(25*a.props.velocity,50),e.strokeStyle="#D20155",e.lineWidth=3,e.stroke(),e.fillStyle="#D20155",e.fillText("Current Velocity: ".concat(Math.round(100*a.props.velocity)/100),a.width/2,90)},a.drawTick=function(e){e.beginPath();var t=a.props.distance*a.distanceScale+a.imgWidth/2;e.moveTo(t,0),e.lineTo(t,-Math.max.apply(Math,Object(m.a)(a.props.elevation))*a.elevationScale),e.strokeStyle="#D20155",e.lineWidth=2,e.stroke()},a.updateFrame=function(){return a.frame+1>19?a.frame=0:a.frame=a.frame+1,400*a.frame},a.drawCyclist=function(e,t){var n=a.props.distance*a.distanceScale+a.imgWidth/2,i=-a.props.elevationAndSlope.elevation*a.elevationScale;e.translate(n,i);var o=-Math.atan(a.props.elevationAndSlope.slope*a.elevationScale/a.distanceScale);e.rotate(o);var s="/cyclist.png"===a.props.img?0:a.updateFrame(),c=-a.imgWidth/2,r=-a.imgWidth;e.drawImage(t,s,0,a.spriteWidth,a.spriteWidth,c,r,a.imgWidth,a.imgWidth),e.rotate(-o),e.translate(-n,-i)},a}return Object(h.a)(t,e),Object(r.a)(t,[{key:"componentDidMount",value:function(){var e=this;this.width=300,this.height=100,this.imgWidth=50,this.contextScale=10,this.elevationScale=10,this.frame=0,this.indexLast=this.props.elevation.length-1,this.distanceTotal=this.indexLast*this.props.distanceToIndexRatio,this.distanceScale=(this.width-this.imgWidth)/this.distanceTotal;var t=this.refs.gameCanvas;t.width=this.width*this.contextScale,t.height=(this.height+100)*this.contextScale,t.style.width="".concat(this.width,"px"),t.style.height="".concat(this.height+100,"px");var a=t.getContext("2d");a.scale(this.contextScale,this.contextScale);var n=new Image;n.src="".concat("/shifting-gears-app-frontend/cyclist-sprite-sheet.png"),this.spriteWidth=400,this.timer=setInterval(function(){return e.drawGame(a,n)},50)}},{key:"componentWillUnmount",value:function(){clearInterval(this.timer)}},{key:"render",value:function(){return i.a.createElement("canvas",{ref:"gameCanvas"})}}]),t}(n.Component),v=function(e){function t(){var e;Object(c.a)(this,t),(e=Object(l.a)(this,Object(d.a)(t).call(this))).startTimer=function(){e.setState({start:Date.now(),distance:0,velocity:0,idxTeethCog:0,grade:0,img:"/cyclist.gif"}),e.milliseconds=250,e.timer=setInterval(function(){var t=e.getDistance(e.milliseconds);t<=100&&e.setState({time:Date.now()-e.state.start,distance:t,velocity:e.getVelocity(),grade:.1*e.getElevationAndSlope().slope})},e.milliseconds)},e.stopTimer=function(){e.createGame(),clearInterval(e.timer),document.getElementById("start-btn").disabled=!1,document.getElementById("shift-up-btn").disabled=!0,document.getElementById("shift-down-btn").disabled=!0},e.createGame=function(){var t;t=0===e.state.distance&&0===e.state.time?0:e.state.distance/(e.state.time/1e3),fetch("https://shifting-gears-app-backend.herokuapp.com/api/v1/games",{method:"POST",headers:{"Content-type":"application/json",Authorization:"Bearer ".concat(localStorage.getItem("token"))},body:JSON.stringify({game:{user_id:e.props.userId,distance:e.state.distance,time:e.state.time/1e3,avg_velocity:t}})}).then(function(e){if(e.ok)return e.json();throw e}).catch(function(e){return e.json().then(function(e){return console.log(e)})})},e.resetTimer=function(){e.setState({time:0})},e.onClickStart=function(t){document.getElementById("start-btn").disabled=!0,document.getElementById("shift-up-btn").disabled=!1,document.getElementById("shift-down-btn").disabled=!1,e.startTimer()},e.getVelocityMax=function(){return e.state.teethChainring/e.teethCog[e.state.idxTeethCog]*2*3.14*e.radiusTire/1e3},e.getAcceleration=function(){return(e.forcePedal*(e.lengthCrankArm*e.teethCog[e.state.idxTeethCog])/(e.state.teethChainring*e.radiusTire)+(-9.81*e.massBikeAndRider*Math.sin(Math.atan(e.state.grade))+-e.Cr*e.massBikeAndRider*9.81*Math.cos(Math.atan(e.state.grade))+-.5*e.Cd*e.ARider*e.rho*Math.pow(e.state.velocity,2)))/e.massBikeAndRider},e.getVelocity=function(){var t=e.getVelocityMax(),a=e.getAcceleration(),n=e.state.velocity;return e.state.grade>=0?n+a<=0&&a<0?(e.setState({img:"/cyclist.png"}),e.stopTimer(),0):n+a<=0?0:n+a<n?n+a:n+a<=t?n+a:t:n+a},e.getDistance=function(t){var a=e.state.distance+e.state.velocity*t/1e3;return a>=100&&(e.setState({img:"/cyclist.png"}),e.stopTimer()),a},e.onClickShiftUp=function(){e.state.time>0&&e.state.idxTeethCog+1<e.teethCog.length&&e.setState({idxTeethCog:e.state.idxTeethCog+1})},e.onClickShiftDown=function(){e.state.time>0&&e.state.idxTeethCog-1>=0&&e.setState({idxTeethCog:e.state.idxTeethCog-1})},e.getElevationAndSlope=function(){if(0!==e.state.distance){var t=e.elevation.length-1,a=Math.floor(e.state.distance/t),n=Math.ceil(e.state.distance/t);if(e.state.distance<100){var i=a*e.distanceToIndexRatio,o=n*e.distanceToIndexRatio,s=e.elevation[a],c=(e.elevation[n]-s)/(o-i);return{elevation:c*(e.state.distance-i)+s,slope:c}}var r=e.elevation.length-1,l=r-1,d=r*e.distanceToIndexRatio,h=l*e.distanceToIndexRatio,u=e.elevation[r];return{elevation:u,slope:(u-e.elevation[l])/(d-h)}}return{elevation:1,slope:0}},e.cadence=1,e.forcePedal=125,e.lengthCrankArm=165,e.radiusTire=350,e.massBikeAndRider=160,e.Cr=.004,e.Cd=1,e.ARider=.4,e.rho=1.225,e.teethCog=[32,28,25,22,20,18,16,14,13,12,11,9.4],e.gearRatio=[];for(var a=0;a<e.teethCog.length;a++)e.gearRatio=e.gearRatio.concat([Math.round(32/e.teethCog[a]*10)/10]);e.velocityMax=[];for(var n=0;n<e.gearRatio.length;n++)e.velocityMax=e.velocityMax.concat([Math.round(2*e.gearRatio[n]*3.14*e.radiusTire/1e3*100)/100]);for(var i=[[1,1],[2,2],[3,3]],o=[1,1,1],s=0;s<3;s++)o=o.concat(i[Math.round(2*Math.random())]);return e.elevation=o.concat([1,1]),e.distanceToIndexRatio=10,e.state={time:0,start:Date.now(),distance:0,velocity:0,teethChainring:32,idxTeethCog:0,grade:0,img:"/cyclist.png"},e}return Object(h.a)(t,e),Object(r.a)(t,[{key:"componentDidMount",value:function(){document.getElementById("shift-up-btn").disabled=!0,document.getElementById("shift-down-btn").disabled=!0}},{key:"componentWillUnmount",value:function(){clearInterval(this.timer)}},{key:"render",value:function(){return i.a.createElement("div",null,i.a.createElement(p,{elevationAndSlope:this.getElevationAndSlope(),distance:this.state.distance,elevation:this.elevation,distanceToIndexRatio:this.distanceToIndexRatio,img:this.state.img,velocityMax:this.velocityMax,velocity:this.state.velocity,idxTeethCog:this.state.idxTeethCog,time:this.state.time}),i.a.createElement("p",null,i.a.createElement("button",{className:"btn shadow-sm btn-sm",id:"start-btn",onClick:this.onClickStart},"Start")," ",i.a.createElement("button",{className:"btn shadow-sm btn-sm shift-btn",id:"shift-up-btn",onClick:this.onClickShiftUp},"Shift Up")," ",i.a.createElement("button",{className:"btn shadow-sm btn-sm shift-btn",id:"shift-down-btn",onClick:this.onClickShiftDown},"Shift Down")))}}]),t}(i.a.Component),g=function(e){function t(){var e;return Object(c.a)(this,t),(e=Object(l.a)(this,Object(d.a)(t).call(this))).onClickCheckbox=function(){e.setState({statsAll:!e.state.statsAll})},e._isMounted=!1,e.state={stats:[],myStats:[],statsAll:!0},e}return Object(h.a)(t,e),Object(r.a)(t,[{key:"componentDidMount",value:function(){var e=this;this._isMounted=!0,fetch("https://shifting-gears-app-backend.herokuapp.com/api/v1/games/top-10",{method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(localStorage.getItem("token"))}}).then(function(e){return e.json()}).then(function(t){return e._isMounted?e.setState({stats:t}):null}).then(fetch("https://shifting-gears-app-backend.herokuapp.com/api/v1/users/top-10-games",{method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(localStorage.getItem("token"))}}).then(function(e){return e.json()}).then(function(t){return e._isMounted?e.setState({myStats:t}):null}))}},{key:"componentWillUnmount",value:function(){this._isMounted=!1}},{key:"render",value:function(){var e=0,t=this.state.statsAll?this.state.stats:this.state.myStats;return i.a.createElement("div",null,i.a.createElement("strong",null,this.state.statsAll?"All Stats ":"My Stats "),i.a.createElement("label",{className:"switch"},i.a.createElement("input",{type:"checkbox",onClick:this.onClickCheckbox}),i.a.createElement("span",{className:"slider round"})),i.a.createElement("table",{className:"table table-sm table-striped table-dark"},i.a.createElement("thead",null,i.a.createElement("tr",null,i.a.createElement("th",{scope:"col"},"#"),i.a.createElement("th",{scope:"col"},"Name"),i.a.createElement("th",{scope:"col"},"Score"))),i.a.createElement("tbody",null,t.map(function(t){return e+=1,i.a.createElement("tr",{key:t.id},i.a.createElement("th",{scope:"row"},e),i.a.createElement("td",null,t.user.username),i.a.createElement("td",null,Math.round(100*t.avg_velocity)/100))}))))}}]),t}(i.a.Component),f=function(e){function t(){var e,a;Object(c.a)(this,t);for(var n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return(a=Object(l.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(i)))).state={active:"Sign in",signedIn:!1,userId:0},a.onClickNav=function(e){var t=e.target,n=document.getElementsByClassName("nav-link active")[0];t!==n&&(n.classList.remove("active"),t.classList.add("active"),a.updateActive(t.getAttribute("name")))},a.updateActive=function(e){a.setState({active:e})},a.updateSignedIn=function(){a.setState({signedIn:!a.state.signedIn})},a.onClickLogout=function(e){a.setState({active:"Sign in",signedIn:!a.state.signedIn,userId:0}),document.getElementsByClassName("nav-link active")[0].classList.remove("active"),document.getElementsByClassName("nav-link")[0].classList.add("active"),localStorage.clear()},a.updateUserId=function(e){a.setState({userId:e})},a}return Object(h.a)(t,e),Object(r.a)(t,[{key:"render",value:function(){var e=this.state.signedIn?i.a.createElement("nav",{className:"nav nav-masthead justify-content-center"},i.a.createElement("div",{className:"nav-link active",name:"Game",onClick:this.onClickNav},"Game"),i.a.createElement("div",{className:"nav-link",name:"Stats",onClick:this.onClickNav},"Stats"),i.a.createElement("div",{className:"nav-link",name:"Log out",onClick:this.onClickLogout},"Log out")):i.a.createElement("nav",{className:"nav nav-masthead justify-content-center"},i.a.createElement("div",{className:"nav-link active",name:"Sign in",onClick:this.onClickNav},"Sign in"),i.a.createElement("div",{className:"nav-link",name:"Sign up",onClick:this.onClickNav},"Sign up"),i.a.createElement("div",{className:"nav-link",name:"Sign in as Incognito",onClick:this.onClickNav},"Incognito")),t=this.state.signedIn?"Game"===this.state.active?i.a.createElement(v,{updateActive:this.updateActive,userId:this.state.userId}):i.a.createElement(g,null):i.a.createElement(u,{active:this.state.active,updateSignedIn:this.updateSignedIn,updateActive:this.updateActive,updateUserId:this.updateUserId});return i.a.createElement("div",{className:"cover-container d-flex w-100 h-100 p-2 mx-auto flex-column"},i.a.createElement("header",{className:"masthead mb-auto"},i.a.createElement("div",{className:"inner"},i.a.createElement("h4",{className:"masthead-brand"},i.a.createElement("img",{className:"img-icon",src:"/shifting-gears-app-frontend/icon.png",alt:""})," Shifting Gears"),e)),i.a.createElement("div",{className:"d-flex justify-content-center"},i.a.createElement("main",{role:"main",className:"inner cover"},t)),i.a.createElement("footer",{className:"mastfoot mt-auto"},i.a.createElement("div",{className:"inner"})))}}]),t}(i.a.Component),y=function(e){function t(){return Object(c.a)(this,t),Object(l.a)(this,Object(d.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(r.a)(t,[{key:"render",value:function(){return i.a.createElement("div",{className:"App"},i.a.createElement(f,null))}}]),t}(n.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));s.a.render(i.a.createElement(y,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}],[[9,1,2]]]);
//# sourceMappingURL=main.05ffd1e1.chunk.js.map